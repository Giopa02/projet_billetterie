<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>

<BorderPane maxHeight="-Infinity" maxWidth="-Infinity" minHeight="-Infinity" minWidth="-Infinity"
            prefHeight="800.0" prefWidth="900.0" styleClass="border-pane"
            stylesheets="@../css/style.css" xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1" fx:controller="Controllers.BilletTabController">

    <!-- BARRE DE NAVIGATION + TITRE -->
    <top>
        <VBox>
            <!-- Barre de navigation -->
            <HBox alignment="CENTER_LEFT" spacing="10.0"
                  style="-fx-background-color: #667eea; -fx-padding: 10px 20px;">
                <children>
                    <Label text="ðŸ‘¨â€ðŸ’¼ ADMINISTRATION"
                           style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: white;" />
                    <HBox HBox.hgrow="ALWAYS" />
                    <Button text="ðŸ‘¥ Clients" onAction="#btnNavClients"
                            style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 8px 15px; -fx-background-radius: 5px; -fx-cursor: hand;" />
                    <Button text="ðŸ“… Ã‰vÃ©nements" onAction="#btnNavEvenements"
                            style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 8px 15px; -fx-background-radius: 5px; -fx-cursor: hand;" />
                    <Button text="ðŸŽ« Billets"
                            style="-fx-background-color: rgba(255,255,255,0.3); -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 8px 15px; -fx-background-radius: 5px; -fx-border-color: white; -fx-border-width: 2px; -fx-border-radius: 5px;" />
                    <Button text="ðŸšª DÃ©connexion" onAction="#btnDeconnexion"
                            style="-fx-background-color: #dc3545; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 8px 15px; -fx-background-radius: 5px; -fx-cursor: hand;" />
                </children>
            </HBox>

            <!-- Titre -->
            <Label styleClass="page-title" text="ðŸŽ« VENTE DE BILLETS" BorderPane.alignment="CENTER">
                <padding>
                    <Insets bottom="10.0" top="10.0" />
                </padding>
            </Label>
        </VBox>
    </top>

    <!-- CONTENU PRINCIPAL AVEC SCROLLPANE -->
    <center>
        <ScrollPane fitToWidth="true" fitToHeight="true" BorderPane.alignment="CENTER">
            <content>
                <VBox spacing="20.0">
                    <padding>
                        <Insets bottom="20.0" left="30.0" right="30.0" top="20.0" />
                    </padding>

                    <!-- ========== Ã‰TAPE 1 : SÃ‰LECTION CLIENT ========== -->
                    <VBox spacing="12.0" styleClass="card">
                        <children>
                            <Label text="ðŸ“‹ Ã‰TAPE 1 : SÃ©lectionner le client"
                                   style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #2196F3;" />

                            <Separator />

                            <HBox spacing="10.0" alignment="CENTER_LEFT">
                                <children>
                                    <TextField fx:id="tfRechercheClient" styleClass="search-field"
                                               promptText="ðŸ” Rechercher un client par nom..."
                                               prefWidth="350.0" />
                                    <Button text="Rechercher" onAction="#btnRechercherClient"
                                            styleClass="btn-search" />
                                </children>
                            </HBox>

                            <VBox fx:id="vboxClients" spacing="8.0" prefHeight="120.0"
                                  style="-fx-background-color: #f8f9fa; -fx-padding: 10px; -fx-background-radius: 5px;">
                                <children>
                                    <Label text="SÃ©lectionnez un client ci-dessous :"
                                           style="-fx-font-size: 12px; -fx-text-fill: #6c757d;" />
                                </children>
                            </VBox>

                            <HBox spacing="10.0" alignment="CENTER_LEFT">
                                <children>
                                    <Label text="Client sÃ©lectionnÃ© :"
                                           style="-fx-font-weight: bold;" />
                                    <Label fx:id="lblClientSelectionne" text="Aucun"
                                           style="-fx-text-fill: #2196F3; -fx-font-weight: bold;" />
                                </children>
                            </HBox>
                        </children>
                        <padding>
                            <Insets top="15.0" right="15.0" bottom="15.0" left="15.0" />
                        </padding>
                    </VBox>

                    <!-- ========== Ã‰TAPE 2 : SÃ‰LECTION Ã‰VÃ‰NEMENT ========== -->
                    <VBox spacing="12.0" styleClass="card">
                        <children>
                            <Label text="ðŸ“… Ã‰TAPE 2 : Choisir l'Ã©vÃ©nement"
                                   style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #2196F3;" />

                            <Separator />

                            <HBox spacing="10.0" alignment="CENTER_LEFT">
                                <children>
                                    <TextField fx:id="tfRechercheEvenement" styleClass="search-field"
                                               promptText="ðŸ” Rechercher un Ã©vÃ©nement..."
                                               prefWidth="350.0" />
                                    <Button text="Rechercher" onAction="#btnRechercherEvenement"
                                            styleClass="btn-search" />
                                    <Button text="ðŸ”„ Tous les Ã©vÃ©nements" onAction="#btnTousEvenements"
                                            styleClass="btn-secondary" />
                                </children>
                            </HBox>

                            <ScrollPane fitToWidth="true" minHeight="400.0" prefHeight="400.0" VBox.vgrow="SOMETIMES"
                                        style="-fx-background-color: transparent;">
                                <content>
                                    <VBox fx:id="vboxEvenements" spacing="10.0">
                                        <padding>
                                            <Insets top="5.0" right="5.0" bottom="5.0" left="5.0" />
                                        </padding>
                                    </VBox>
                                </content>
                            </ScrollPane>

                            <HBox spacing="10.0" alignment="CENTER_LEFT">
                                <children>
                                    <Label text="Ã‰vÃ©nement sÃ©lectionnÃ© :"
                                           style="-fx-font-weight: bold;" />
                                    <Label fx:id="lblEvenementSelectionne" text="Aucun"
                                           style="-fx-text-fill: #2196F3; -fx-font-weight: bold;" />
                                </children>
                            </HBox>
                        </children>
                        <padding>
                            <Insets top="15.0" right="15.0" bottom="15.0" left="15.0" />
                        </padding>
                    </VBox>

                    <!-- ========== Ã‰TAPE 3 : CONFIRMATION ========== -->
                    <VBox spacing="12.0" styleClass="card">
                        <children>
                            <Label text="âœ… Ã‰TAPE 3 : Confirmer l'achat"
                                   style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #4CAF50;" />

                            <Separator />

                            <VBox spacing="8.0" style="-fx-background-color: #f8f9fa; -fx-padding: 15px; -fx-background-radius: 5px;">
                                <children>
                                    <Label text="RÃ©capitulatif de la commande :"
                                           style="-fx-font-weight: bold; -fx-font-size: 13px;" />
                                    <Label fx:id="lblRecapClient" text="â€¢ Client : -" />
                                    <Label fx:id="lblRecapEvenement" text="â€¢ Ã‰vÃ©nement : -" />
                                    <Label fx:id="lblRecapDate" text="â€¢ Date : -" />
                                    <Label fx:id="lblRecapHoraire" text="â€¢ Horaire : -" />
                                    <Label fx:id="lblRecapPrix" text="â€¢ Prix unitaire : -" />
                                </children>
                            </VBox>

                            <HBox spacing="15.0" alignment="CENTER_LEFT" styleClass="form-row">
                                <children>
                                    <Label text="Nombre de billets :" styleClass="form-label" />
                                    <ComboBox fx:id="cbNombreBillets" prefWidth="100.0"
                                              promptText="1" />
                                </children>
                            </HBox>

                            <HBox spacing="20.0" alignment="CENTER"
                                  style="-fx-background-color: #e8f5e9; -fx-padding: 20px; -fx-background-radius: 8px; -fx-border-color: #4CAF50; -fx-border-width: 2px; -fx-border-radius: 8px;">
                                <children>
                                    <Label text="TOTAL :"
                                           style="-fx-font-size: 20px; -fx-font-weight: bold;" />
                                    <Label fx:id="lblTotal" text="0,00 â‚¬"
                                           style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #4CAF50;" />
                                </children>
                            </HBox>

                            <HBox spacing="20.0" alignment="CENTER">
                                <padding>
                                    <Insets top="10.0" />
                                </padding>
                                <children>
                                    <Button text="âœ… VALIDER LA VENTE" onAction="#btnValider"
                                            styleClass="btn-add"
                                            style="-fx-font-size: 16px; -fx-padding: 15px 40px;" />
                                    <Button text="âŒ ANNULER" onAction="#btnAnnuler"
                                            styleClass="btn-delete" />
                                </children>
                            </HBox>
                        </children>
                        <padding>
                            <Insets top="15.0" right="15.0" bottom="15.0" left="15.0" />
                        </padding>
                    </VBox>
                </VBox>
            </content>
        </ScrollPane>
    </center>

    <!-- HISTORIQUE EN BAS AVEC BOUTONS MODIFIER/SUPPRIMER -->
    <bottom>
        <VBox spacing="10.0" BorderPane.alignment="CENTER">
            <padding>
                <Insets bottom="20.0" left="30.0" right="30.0" top="10.0" />
            </padding>
            <children>
                <HBox alignment="CENTER_LEFT" spacing="15.0">
                    <children>
                        <Label text="ðŸ“Š HISTORIQUE DES VENTES (aujourd'hui)"
                               style="-fx-font-size: 14px; -fx-font-weight: bold;" />
                        <Button text="ðŸ”„ Actualiser" onAction="#btnActualiserHistorique"
                                styleClass="btn-secondary"
                                style="-fx-font-size: 12px; -fx-padding: 5px 15px;" />
                    </children>
                </HBox>

                <TableView fx:id="tableHistorique" prefHeight="150.0">
                    <columnResizePolicy>
                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                    </columnResizePolicy>
                    <columns>
                        <TableColumn fx:id="colHistoId" prefWidth="40.0" text="ID" />
                        <TableColumn fx:id="colHistoClient" prefWidth="120.0" text="Client" />
                        <TableColumn fx:id="colHistoEvenement" prefWidth="150.0" text="Ã‰vÃ©nement" />
                        <TableColumn fx:id="colHistoPrix" prefWidth="70.0" text="Prix" />
                        <TableColumn fx:id="colHistoHeure" prefWidth="80.0" text="Heure" />
                        <TableColumn fx:id="colHistoActions" prefWidth="150.0" text="Actions" />
                    </columns>
                </TableView>

                <Label text="ðŸ’¡ Astuce : SÃ©lectionnez un billet dans le tableau pour le modifier ou le supprimer"
                       style="-fx-font-size: 11px; -fx-text-fill: #6c757d; -fx-font-style: italic;" />
            </children>
        </VBox>
    </bottom>
</BorderPane>